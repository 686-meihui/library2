<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ç­ç´šæ•¸ä½åœ–æ›¸é¤¨ - å¯¦åäº’è©•æ­£å¼ç‰ˆ</title>
    <style>
        /* æ¨£å¼è¨­å®š */
        :root { --wood-dark: #3e2723; --wood-light: #5d4037; --accent: #f39c12; --book-spine: #2c3e50; }
        body { background: #222 url('https://www.transparenttextures.com/patterns/dark-wood.png'); font-family: "Microsoft JhengHei", sans-serif; margin: 0; padding: 40px 20px; color: #f5f5f5; display: flex; flex-direction: column; align-items: center; }
        .library-system { width: 100%; max-width: 1000px; display: flex; flex-direction: column; }
        .shelf-layer { background: linear-gradient(to bottom, #4e342e 0%, #3e2723 100%); padding: 40px 30px 15px 30px; display: grid; grid-template-columns: repeat(5, 1fr); gap: 30px; border-left: 15px solid #2d1b18; border-right: 15px solid #2d1b18; box-shadow: inset 0 20px 30px rgba(0,0,0,0.5); position: relative; }
        .shelf-board { height: 25px; background: #2d1b18; width: calc(100% + 30px); margin-left: -15px; box-shadow: 0 10px 20px rgba(0,0,0,0.6); border-top: 2px solid #5d4037; z-index: 2; margin-bottom: 20px; }
        .book-item { perspective: 1000px; display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .book-cover { width: 100px; height: 145px; background: white; border-left: 12px solid var(--book-spine); box-shadow: 5px 5px 15px rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; padding: 10px; box-sizing: border-box; text-align: center; color: #333; font-weight: bold; transition: 0.4s; }
        .book-item:hover .book-cover { transform: rotateY(-25deg) translateZ(20px); }
        .student-tag { margin-top: 15px; font-size: 12px; background: rgba(0,0,0,0.6); padding: 2px 8px; border-radius: 4px; }
        
        /* å½ˆçª—æ¨£å¼ */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; z-index: 2000; }
        .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fff; width: 95%; max-width: 1100px; height: 90vh; border-radius: 8px; display: flex; overflow: hidden; }
        .pdf-side { flex: 1; background: #333; position: relative; }
        .control-side { width: 320px; padding: 25px; color: #333; display: flex; flex-direction: column; position: relative; box-sizing: border-box; }
        
        .close-btn { position: absolute; top: 10px; right: 15px; font-size: 24px; background: #eee; border: 1px solid #ccc; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; z-index: 10; display: flex; align-items: center; justify-content: center; }
        .star-rank span { font-size: 30px; cursor: pointer; color: #ccc; }
        .star-rank span.on { color: var(--accent); }
        textarea { width: 100%; height: 100px; margin: 5px 0; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        input[type="number"] { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; font-size: 16px; }
        
        #big-file-link { 
            display: block; margin: 10px 0; padding: 12px; 
            background-color: #3498db; color: white; text-align: center; 
            text-decoration: none; border-radius: 4px; font-weight: bold; font-size: 14px;
        }

        .submit-all { background: #27ae60; color: white; padding: 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 16px; margin-top: auto; }
        .submit-all:hover { background: #219150; }
    </style>
</head>
<body>

    <div style="text-align:center;">
        <h1>ğŸ“š 113å­¸å¹´åº¦ è‡ªä¸»å­¸ç¿’å ±å‘Šåœ–æ›¸é¤¨</h1>
        <p>å¥³ç”Ÿ 01-15 | ç”·ç”Ÿ 21-36</p>
    </div>

    <div class="library-system" id="library-main"></div>

    <div class="modal-overlay" id="modal">
        <div class="modal-content">
            <div class="pdf-side" id="pdf-box"></div>
            <div class="control-side">
                <button class="close-btn" onclick="closeBook()">Ã—</button>
                <h2 id="view-title" style="margin-top:10px; font-size: 20px;">å­¸ç”Ÿä½œå“</h2>
                
                <p style="margin: 10px 0 5px 0;"><strong>Step 1: ä½ çš„åº§è™Ÿ (å¿…å¡«)</strong></p>
                <input type="number" id="reviewer-id" placeholder="è«‹è¼¸å…¥ä½ çš„åº§è™Ÿ" min="1" max="40">

                <p style="margin: 10px 0 5px 0;"><strong>Step 2: çµ¦äºˆè©•åˆ†</strong></p>
                <div class="star-rank" id="star-box">
                    <span onclick="rate(1)">â˜…</span><span onclick="rate(2)">â˜…</span><span onclick="rate(3)">â˜…</span><span onclick="rate(4)">â˜…</span><span onclick="rate(5)">â˜…</span>
                </div>

                <p style="margin: 15px 0 5px 0;"><strong>Step 3: æ’°å¯«å›é¥‹</strong></p>
                <textarea id="comment" placeholder="è«‹è¼¸å…¥æ‚¨å°é€™ä»½å ±å‘Šçš„çœ‹æ³•..."></textarea>
                
                <a id="big-file-link" href="#" target="_blank">ğŸ“– é–‹å•Ÿå…¨è¢å¹•é–±è®€</a>

                <button class="submit-all" onclick="sendData()">é€å‡ºè©•åƒ¹ä¸¦å„²å­˜</button>
            </div>
        </div>
    </div>

    <script>
        const LIB_CONFIG = {
            googleFormId: "1FAIpQLSfQJRD9CzMtKpahLhSiXl1IbuEEADoPOF7232TW41rMmikXrw",
            entryIds: { 
                studentId: "entry.824158856", // ä½œå“åº§è™Ÿ
                stars: "entry.612283565",     // æ˜Ÿç­‰
                comment: "entry.266228200",   // è©•èª
                reviewerId: "entry.1109329616" // è©•åˆ†è€…åº§è™Ÿ (å·²æ›´æ–°)
            },
            
            googleDriveFiles: {
                "13": "https://heyzine.com/flip-book/f7caf27db8.html",
                "01": "æª”æ¡ˆID_01",
                "21": "æª”æ¡ˆID_21"
            }
        };

        function initLibrary() {
            const container = document.getElementById('library-main');
            let studentIds = [];
            for (let i = 1; i <= 15; i++) studentIds.push(i < 10 ? '0' + i : '' + i);
            for (let i = 21; i <= 36; i++) studentIds.push('' + i);

            let currentShelf;
            studentIds.forEach((id, index) => {
                if (index % 5 === 0) {
                    currentShelf = document.createElement('div');
                    currentShelf.className = 'shelf-layer';
                    container.appendChild(currentShelf);
                }
                const book = document.createElement('div');
                book.className = 'book-item';
                book.onclick = () => openBook(id);
                book.innerHTML = `<div class="book-cover">è‡ªä¸»å­¸ç¿’<br>#${id}</div><div class="student-tag">åº§è™Ÿ ${id}</div>`;
                currentShelf.appendChild(book);

                if ((index + 1) % 5 === 0 || (index + 1) === studentIds.length) {
                    const board = document.createElement('div');
                    board.className = 'shelf-board';
                    container.appendChild(board);
                }
            });
        }

        let activeId = null, activeStars = 0;

        function openBook(id) {
            activeId = id; activeStars = 0; rate(0);
            document.getElementById('comment').value = "";
            document.getElementById('reviewer-id').value = "";
            document.getElementById('modal').style.display = 'block';
            document.getElementById('view-title').innerText = `åº§è™Ÿ ${id} çš„ä½œå“`;
            
            const source = LIB_CONFIG.googleDriveFiles[id];
            const bigFileBtn = document.getElementById('big-file-link');
            let finalUrl = "";

            if (source && source.startsWith('http')) {
                finalUrl = source;
                bigFileBtn.href = source;
                bigFileBtn.innerText = "ğŸ“– é–‹å•Ÿå…¨è¢å¹•é–±è®€";
            } else if (source && source !== "æª”æ¡ˆID_" + id) {
                finalUrl = `https://drive.google.com/file/d/${source}/preview`;
                bigFileBtn.href = `https://drive.google.com/file/d/${source}/view?usp=sharing`;
                bigFileBtn.innerText = "ğŸ“¢ æª”æ¡ˆå¤ªå¤§ç„¡æ³•é è¦½ï¼Ÿé»æ­¤å¦é–‹";
            }

            if (finalUrl) {
                document.getElementById('pdf-box').innerHTML = `<iframe src="${finalUrl}" width="100%" height="100%" style="border:none;" allowfullscreen></iframe>`;
                bigFileBtn.style.display = "block";
            } else {
                document.getElementById('pdf-box').innerHTML = `<div style="color:white; padding:50px; text-align:center;">å°šæœªè¨­å®šåº§è™Ÿ ${id} çš„ä½œå“ã€‚</div>`;
                bigFileBtn.style.display = "none";
            }
        }

        function closeBook() { document.getElementById('modal').style.display = 'none'; document.getElementById('pdf-box').innerHTML = ""; }
        function rate(s) {
            activeStars = s;
            const stars = document.querySelectorAll('#star-box span');
            stars.forEach((span, idx) => span.className = idx < s ? 'on' : '');
        }

        function sendData() {
            const rId = document.getElementById('reviewer-id').value;
            const comment = document.getElementById('comment').value;
            
            if(!rId) return alert("è«‹è¼¸å…¥æ‚¨çš„åº§è™Ÿä»¥ç¤ºè² è²¬ï¼");
            if(!activeStars || !comment) return alert("è«‹å®Œæˆè©•åˆ†èˆ‡å›é¥‹å…§å®¹ï¼");
            
            const starText = `ç¬¬${activeStars}é¡†æ˜Ÿ`;
            const formURL = `https://docs.google.com/forms/d/e/${LIB_CONFIG.googleFormId}/formResponse`;
            const params = new URLSearchParams();
            
            params.append(LIB_CONFIG.entryIds.studentId, activeId);
            params.append(LIB_CONFIG.entryIds.stars, starText);
            params.append(LIB_CONFIG.entryIds.comment, comment);
            params.append(LIB_CONFIG.entryIds.reviewerId, rId);

            fetch(formURL, { method: 'POST', mode: 'no-cors', body: params }).then(() => {
                alert("è©•åƒ¹å·²æˆåŠŸé€å‡ºï¼è¬è¬ä½ çš„å›é¥‹ã€‚");
                closeBook();
            }).catch(err => {
                alert("ç¶²è·¯ç•°å¸¸ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚");
            });
        }

        initLibrary();
        window.onclick = (e) => { if(e.target.id === 'modal') closeBook(); }
    </script>
</body>
</html>